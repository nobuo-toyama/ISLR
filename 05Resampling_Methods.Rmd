---
title: "05 Resampling Methods"
author: "nobuo"
date: "2021/3/31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Resampling Methods

##  Lab: Cross-Validation and the Bootstrap

### The Validation Set Approach
We begin by using the `sample()` function to split the set of observations `sample()` into two halves, by selecting a random subset of 196 observations out of the original 392 observations. We refer to these observations as the training set.

```{r}
library(ISLR)
set.seed(1)
train <- sample(392, 196)
```
We then use the `subset` option in `lm()` to fit a linear regression using only the observations corresponding to the training set.
```{r}
lm.fits <- lm(mpg ~ horsepower, data = Auto, subset = train)
```
We now use the `predict()` function to estimate the response for all 392 observations, and we use the `mean()` function to calculate the MSE of the 196 observations in the validation set.
```{r}
attach(Auto)
mean((mpg - predict(lm.fits, Auto))[-train]^2)
```

```{r}
lm.fit2 <- lm(mpg ~ poly(horsepower, 2), data = Auto, subset = train)
mean((mpg - predict(lm.fit2, Auto))[-train]^2)
lm.fit3 <- lm(mpg ~ poly(horsepower, 3), data = Auto, subset = train)
mean((mpg - predict(lm.fit3, Auto))[-train]^2)
```
### Leave-One-Out Cross-Validation

```{r}
library(boot)
glm.fits <- glm(mpg ~ horsepower, data = Auto)
cv.err <- cv.glm(Auto, glm.fits)
cv.err$delta
```
```{r}
cv.error <- rep(0, 5)
for (i in 1:5) {
glm.fits <- glm(mpg ~ poly(horsepower, i), data = Auto)  
cv.error[i] <- cv.glm(Auto, glm.fits)$delta[1]
}
cv.error
```
### k-Fold Cross-Validation

```{r}
set.seed(17)
cv.error.10 <- rep(0, 10)
for (i in 1:10) {
glm.fits <- glm(mpg ~ poly(horsepower, i), data = Auto)  
cv.error.10[i] <- cv.glm(Auto, glm.fits, K=10)$delta[1]
}
cv.error.10
```

### The Bootstrap

```{r}
alpha.fn <- function(data, index) {
  X <- data$X[index]
  Y <- data$Y[index]
  return((var(Y) - cor(X, Y))/(var(X) + var(Y) -2*cor(X, Y)))
}
alpha.fn(Portfolio, 1:100)
```
```{r}
set.seed(1)
alpha.fn(Portfolio, sample(100, 100, replace = TRUE))
```


```{r}
boot(Portfolio, alpha.fn, R = 1000)
```

```{r}
boot.fn <- function(data, index) {
  return(coef(lm(mpg ~ horsepower, data = data, subset = index)))
}
boot.fn(Auto, 1:392)
```

```{r}
set.seed(1)
boot.fn(Auto, sample(392, 392, replace = TRUE))
boot(Auto, boot.fn, 1000)
```





